# LLM 기반 브리핑 리포트 자동 생성

## 개요

RegScan이 수집한 규제 데이터를 기반으로 LLM이 신문 기사 스타일의 브리핑 리포트를 자동 생성한다.

## 현재 상태

- 시안: `docs/proposal/report_mockup.html`
- 수동 작성된 예시 콘텐츠
- LLM 연동 미구현

## 목표 상태

```
[수집 데이터] → [프롬프트 조합] → [LLM 생성] → [브리핑 리포트]
```

---

## 리포트 구조

### 1. 헤드라인
```
FDA·EMA 동시 승인 '{drug_name}', 국내 도입 가능성은?
```

### 2. 서브타이틀
- 적응증 요약
- 핵심 이슈 1줄

### 3. 핵심 요약 (4줄)
- 글로벌 승인 현황
- 지정 현황 (Breakthrough, PRIME, Orphan 등)
- 국내 현황 (MFDS, CRIS)
- **메드클레임 관점** 시사점

### 4. 본문 섹션
| 섹션 | 내용 |
|------|------|
| 글로벌 승인 현황 | FDA/EMA 승인일, 적응증, 지정 현황 |
| 승인 타임라인 | 시각적 타임라인 |
| 국내 도입 전망 | MFDS 허가, CRIS 임상 현황 |
| 메드클레임 시사점 | 급여/비급여 관점 분석 |
| 경쟁 환경 | 동일 적응증 경쟁 약물 |

### 5. 출처 & 면책
- 데이터 출처 명시
- AI 생성 고지

---

## 필요 데이터

### 현재 수집 중
| 데이터 | 소스 | 용도 |
|--------|------|------|
| FDA 승인 | openFDA API | 승인일, 적응증, 지정 현황 |
| EMA 승인 | EMA Open Data | 승인일, 적응증, PRIME/Orphan |
| MFDS 허가 | 공공데이터포털 | 국내 허가 여부 |
| CRIS 임상 | 공공데이터포털 | 국내 임상 진행 현황 |

### 추가 필요 (메드클레임 시사점용)
| 데이터 | 소스 | 용도 |
|--------|------|------|
| 약가 정보 | HIRA 약가목록 | 예상 약제비 |
| 급여 기준 | HIRA 급여기준 | 급여/비급여 판단 |
| 산정특례 | 희귀질환 목록 | 본인부담률 |
| 해외 약가 | GoodRx, NICE | 가격 참조 |

---

## LLM 프롬프트 설계

### 메인 프롬프트
```
당신은 의약품 규제 전문 기자입니다.
아래 데이터를 기반으로 브리핑 리포트를 작성하세요.

## 데이터
{drug_data_json}

## 작성 가이드
- 신문 기사 스타일로 작성
- 객관적 사실 기반
- 국내 도입 가능성 분석 포함
- 메드클레임(의료비 청구) 관점 시사점 포함

## 메드클레임 시사점 작성 시 고려사항
- 희귀질환 여부 → 산정특례 적용 가능성
- 예상 약가 → 고가 약제비 청구 이슈
- 급여/비급여 → 실손보험 청구 관련
```

### 메드클레임 시사점 전용 프롬프트
```
이 약물의 메드클레임(의료비 청구) 관점 시사점을 분석하세요.

## 약물 정보
- 약물명: {drug_name}
- 적응증: {indication}
- 희귀의약품 지정: {orphan_status}
- 예상 연간 약가: {estimated_price}

## 분석 항목
1. 급여 적용 시
   - 예상 본인부담률
   - 사전심사/적정성 평가 필요 여부

2. 비급여 시
   - 실손보험 청구 가능 여부
   - 환자 부담 이슈

3. 기타 고려사항
   - 희귀의약품센터 긴급도입 가능성
   - 임상시험 참여를 통한 접근
```

---

## 구현 계획

### Phase 1: 템플릿 기반 (현재)
- 수동 작성된 리포트 템플릿
- 데이터만 자동 삽입
- LLM 미사용

### Phase 2: LLM 보조 생성
- 기본 구조는 템플릿
- 본문/분석은 LLM 생성
- human-in-the-loop 검수

### Phase 3: 완전 자동화 (목표)
- 전체 리포트 LLM 생성
- 팩트체크 자동화
- 정기 발행 자동화

---

## 기술 스택

```
regscan/
├── report/
│   ├── generator.py      # 리포트 생성기
│   ├── prompts.py        # 프롬프트 템플릿
│   ├── templates/        # HTML/MD 템플릿
│   └── medclaim.py       # 메드클레임 시사점 생성
```

### 의존성
```toml
[project.optional-dependencies]
llm = [
    "openai>=1.0.0",
    "anthropic>=0.18.0",
]
```

---

## 예시 출력

### 입력 데이터
```json
{
  "inn": "seladelpar",
  "brand_name": "Livdelzi",
  "indication": "원발성 담즙성 담관염(PBC)",
  "fda": {
    "approval_date": "2025-08-14",
    "designations": ["Breakthrough Therapy", "Orphan Drug"]
  },
  "ema": {
    "approval_date": "2025-09-22",
    "designations": ["PRIME", "Orphan Drug"]
  },
  "mfds": null,
  "cris_trials": [],
  "estimated_annual_cost_usd": 50000
}
```

### 출력: 메드클레임 시사점
```
💡 메드클레임 시사점

급여 적용 시: 희귀질환 산정특례 대상으로 약제비 본인부담률 10% 적용 예상.
해외 가격(연간 약 $50,000) 기준 시 고가 약제비 청구가 예상되며,
사전심사 및 요양급여 적정성 평가 대비 필요.

비급여 처방 시: 전액 환자 부담으로 실손보험 청구 이슈 발생 가능.
희귀의약품센터를 통한 긴급도입 가능성도 모니터링 필요.
```

---

## 참고

- 시안 파일: `docs/proposal/report_mockup.html`
- 메드클레임 서비스 연동 필요
- HIRA 데이터 수집은 별도 태스크로 진행
