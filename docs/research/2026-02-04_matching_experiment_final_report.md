# MFDS ↔ HIRA 매칭 실험 최종 리포트

> 작성일: 2026-02-04
> 버전: v6 (최종)
> 작성자: Claude

---

## 1. 실험 개요

### 1.1 목표
MFDS 허가 의약품(44,035건)에 대해 HIRA 급여 정보 연결

### 1.2 핵심 발견
- **의약품표준코드**(15067462)가 아닌 **의약품주성분**(15067461) 마스터 사용 필요
- 의약품주성분 마스터는 HIRA 의성분코드의 **99.6% 커버**
- 정규화를 통해 **75.4% 매칭률** 달성

---

## 2. 데이터 소스

| 데이터 | 출처 | 건수 | 용도 |
|--------|------|------|------|
| MFDS 허가정보 | data.go.kr/15075057 | 44,035 | 매칭 대상 |
| **의약품주성분 마스터** | data.go.kr/15067461 | 59,631 (20,114 고유 코드) | **핵심 브릿지** |
| 의약품표준코드 | data.go.kr/15067462 | 305,522 | 참고용 (일반명코드 45% 미채움) |
| ATC 매핑 | data.go.kr/15118958 | 21,953 | 보조 브릿지 |
| HIRA 적용약가 | biz.hira.or.kr | 59,004 (9,002 고유 코드) | 급여 정보 |

### 2.1 의약품표준코드 vs 의약품주성분

| 항목 | 의약품표준코드 | 의약품주성분 |
|------|--------------|-------------|
| 성격 | 제품 목록 | **성분 마스터** |
| 일반명코드 채움률 | 44.6% | 100% |
| HIRA 커버리지 | 67.4% | **99.6%** |

**결론**: 의약품주성분 마스터를 브릿지로 사용해야 함

---

## 3. 매칭 전략

### 3.1 매칭 흐름
```
MFDS ITEM_INGR_NAME (성분명)
       ↓ 정규화
의약품주성분 마스터 일반명
       ↓ exact match
일반명코드 (예: 107601ATB)
       ↓
HIRA ingredient_code
       ↓
급여기준, 상한가
```

### 3.2 정규화 규칙 (Exact Match 유지)

```python
def normalize_name(name: str) -> str:
    # 1. 소문자 변환
    name = name.lower()

    # 2. 괄호 제거: "(as amlodipine)" 등
    name = re.sub(r'\s*\(as[^)]*\)', '', name)
    name = re.sub(r'\s*\([^)]*\)', '', name)

    # 3. 수화물 형태 제거
    hydrates = ['trihydrate', 'dihydrate', 'monohydrate', 'hydrate', ...]
    for h in hydrates:
        name = name.replace(h, '')

    # 4. 공백 정리
    return ' '.join(name.split()).strip()
```

**중요**: 정규화 ≠ 퍼지매칭. 정규화 후 **문자열 완전 일치**만 매칭

### 3.3 정규화 가능/불가 판단

| 정규화 | 가능 여부 | 이유 |
|--------|----------|------|
| 대소문자 통일 | **OK** | 같은 성분 |
| 괄호 제거 `(as ...)` | **OK** | 표기 방식 차이 |
| 수화물 제거 `trihydrate` | **OK** | 같은 성분, 결정수 차이 |
| 철자 수정 `besylate→besilate` | **OK** | 명백한 오타 |
| 철자 수정 `tartarate→tartrate` | **OK** | 명백한 오타 |
| **hydrochloride vs dihydrochloride** | **NO** | **다른 화합물** |
| **Micronized 등 제형** | **주의** | 같은 성분이나 제형 다름 |

---

## 4. 실험 결과

### 4.1 버전별 매칭률

| 버전 | 매칭 건수 | 매칭률 | 개선 내용 |
|------|----------|--------|----------|
| v4 | 27,116 | 61.6% | 의약품표준코드 사용 |
| v5 | 27,618 | 62.7% | 의약품주성분 마스터 사용 |
| **v6** | **33,194** | **75.4%** | 괄호/수화물 정규화 추가 |

### 4.2 v6 최종 결과

```
전체 MFDS: 44,035건
HIRA 연결: 33,194건 (75.4%)

매칭 방법:
  - normalized: 32,940건 (74.8%)
  - atc: 254건 (0.6%)
  - unmatched: 10,841건 (24.6%)

급여 현황:
  - 급여: 18,201건 (41.3%)
  - 삭제: 14,949건 (33.9%)
  - 미연결: 10,841건 (24.6%)
```

---

## 5. 미연결 10,841건 분석

### 5.1 구성

| 분류 | 건수 | 비율 |
|------|------|------|
| 성분명 있음 | 10,743 | 99.1% |
| 성분명 없음 (캡슐, 기자재) | 98 | 0.9% |

### 5.2 한약재/생약 vs 양약

| 분류 | 건수 | 비율 | 비고 |
|------|------|------|------|
| 한약재/생약 | 4,990 | 46.4% | HIRA 급여 대상 아님 |
| 양약 | 5,753 | 53.6% | 추가 분석 필요 |

### 5.3 양약 미매칭 원인

| 원인 | 예시 | 건수 | 해결 가능 |
|------|------|------|----------|
| **비급여 약물** | Tadalafil(시알리스) | ~1,000+ | X (급여 대상 아님) |
| 철자 차이 | besylate vs besilate | ~500 | O (정규화) |
| 제형 정보 | Micronized, Coated | ~800 | △ (주의 필요) |
| 다른 화합물 | hydrochloride vs dihydrochloride | ~300 | X (오매칭 위험) |
| 마스터 미등재 | 신약 등 | ~1,000+ | X |

### 5.4 Tadalafil 사례 분석

```
MFDS: "Tadalafil" (191건)
마스터: tadalafil 코드 14개 존재 (560701ATB 등)
HIRA: 해당 코드 모두 미등재 [HIRA:X]

→ Tadalafil(시알리스)은 발기부전 치료제로 한국에서 "비급여"
→ 매칭 로직 문제 아님, 애초에 급여 대상이 아님
```

### 5.5 Cetirizine 사례 분석

```
MFDS: "Cetirizine Hydrochloride"
마스터: "cetirizine dihydrochloride"

→ hydrochloride ≠ dihydrochloride (다른 화합물)
→ 정규화하면 오매칭 위험
→ 추가 정규화 불가
```

---

## 6. 프로덕션 코드 결과 (최종)

### 6.1 전체 현황

프로덕션 코드(`regscan/map/ingredient_bridge.py`) 실행 결과:

```
전체 MFDS: 44,035건

┌─────────────────────────────────────────────────────┐
│  HIRA 연결 성공: 33,341건 (75.7%)                    │
│    ├─ 급여: 17,996건 (40.9%)                        │
│    └─ 삭제: 15,345건 (34.8%)                        │
├─────────────────────────────────────────────────────┤
│  미연결: 10,694건 (24.3%)                           │
│    ├─ 비급여: 3,856건 (8.8%)  ← 마스터O, HIRA X     │
│    ├─ 미발견: 3,676건 (8.3%)  ← 마스터에 없음        │
│    └─ 한약재: 3,362건 (7.6%)  ← 별도 급여체계        │
└─────────────────────────────────────────────────────┘
```

### 6.2 미연결 10,694건 상세 분석

| 분류 | 건수 | 비율 | 급여 대상? |
|------|------|------|----------|
| **비급여** | 3,856 | 36.1% | **X** (Tadalafil 등) |
| **한약재** | 3,362 | 31.4% | **X** (일반 급여 아님) |
| 미발견 | 3,676 | 34.4% | 불명 (아래 분석) |

**미연결 중 급여 대상 아닌 것:** 비급여 + 한약재 = **7,218건 (67.5%)**

### 6.3 미발견 3,676건 상세 분석

#### TOP 30 미발견 성분

| 건수 | 성분명 | 미발견 원인 |
|------|--------|------------|
| 144 | Rivaroxaban Micronized | 제형 정보 |
| 103 | Oxygen | 의료용 가스 |
| 81 | Metformin.../Sitagliptin... | 복합제 |
| 80 | Limaprost Alfadex | 마스터 미등재 |
| 66 | Clarithromycin Coated Granules | 제형 정보 |
| 60 | Albendazole | 마스터 미등재 |
| 60 | Itraconazole Solid Dispersions | 제형 정보 |
| 48 | Duloxetine Enteric-Coated Granules | 제형 정보 |
| 47 | Nitrogen | 의료용 가스 |
| 35 | Carbon Dioxide | 의료용 가스 |
| 31 | Plasma Cryoprecipitates | 혈액제제 |
| 30 | Aripiprazole Micronized | 제형 정보 |
| 29 | Thymosin-Alpha 1 | 마스터 미등재 |
| 24 | Human Placenta Extract | 추출물 |

#### 미발견 원인 분류

| 원인 | 건수/성분 | 설명 | 정규화 가능 |
|------|----------|------|------------|
| **제형 정보** | 194개 성분 | Micronized, Coated, Granules 등 | △ 위험 |
| **복합제** | 402개 성분 | A/B/C 형태 | X |
| **의료용 가스** | 185건 | O2, N2, CO2 | 별도 체계 |
| **혈액제제** | 84건 | Plasma, Albumin 등 | 별도 체계 |
| **추출물류** | 282건 | Extract 포함 | △ |
| **성분명 없음** | 98건 | 캡슐, 기자재 | X |
| **마스터 미등재** | 나머지 | 신약, 특수 성분 | X |

#### 제형 정보 정규화 위험성

```
MFDS: "Rivaroxaban Micronized" (144건)
마스터: "rivaroxaban(micronized)" [HIRA: 급여]

→ Micronized 제거하면 매칭 가능
→ BUT 제형이 다르면 급여 조건 다를 수 있음
→ 오매칭 위험 → 정규화 하지 않음
```

### 6.4 정규화 규칙 (프로덕션 적용)

| 정규화 | 적용 | 근거 |
|--------|------|------|
| 대소문자 통일 | O | 같은 성분 |
| `(as ...)` 괄호 제거 | O | 표기 방식 차이 |
| 수화물 제거 | O | 같은 성분, 결정수만 다름 |
| `besylate→besilate` | O | USAN→INN 표기 통일 |
| `tartarate→tartrate` | O | 명백한 오타 ([출처](https://www.merriam-webster.com/dictionary/tartrate)) |
| **hydrochloride vs dihydrochloride** | **X** | 다른 화합물 |
| **Micronized 등 제형** | **X** | 제형별 급여 조건 다를 수 있음 |
| **복합제 분리** | **X** | 조합별 급여 다름 |

---

## 7. 한약재 처리

### 7.1 현황
- HIRA 한약재 제품코드 DB: "첩약 시범사업"용
- 일반 급여 대상 아님
- 별도 처리 필요

### 7.2 한약재 DB 정보
- URL: https://www.hira.or.kr/bbsDummy.do?pgmid=HIRAA020002000100&brdScnBltNo=4&brdBltNo=11919
- 2026.02.01 이후 급여 적용 (시범사업)
- 문의: 약가산정부 (033-739-1493)

---

## 8. 결론

### 8.1 달성 결과
- MFDS 44,035건 중 **33,341건 (75.7%)** HIRA 연결 성공
- **Exact match 유지** (퍼지매칭 없음)
- 글로벌 핵심 약물 (pembrolizumab, nivolumab, semaglutide 등) 급여 확인 성공

### 8.2 미연결 24.3% (10,694건) 분석

| 분류 | 건수 | 비율 | 급여 대상 |
|------|------|------|----------|
| 비급여 | 3,856 | 36.1% | **X** |
| 한약재 | 3,362 | 31.4% | **X** |
| 미발견 | 3,676 | 34.4% | 대부분 X |

**미연결의 67.5%는 급여 대상 아님** (비급여 + 한약재)

미발견 3,676건 원인:
- 제형 정보 (Micronized 등): 194개 성분
- 복합제: 402개 성분
- 의료용 가스: 185건
- 혈액제제: 84건
- 마스터 미등재: 나머지

### 8.3 추가 개선 가능성

| 개선 항목 | 예상 효과 | 위험도 | 결정 |
|----------|----------|--------|------|
| besylate→besilate | 적용됨 | 낮음 | **O** |
| tartarate→tartrate | 적용됨 | 낮음 | **O** |
| 제형 정규화 (Micronized 등) | +2~3% | **높음** | **X** |
| 복합제 분리 매칭 | +1~2% | **높음** | **X** |

### 8.4 권장 매칭률
- **현재 75.7%가 현실적인 최대치**
- 미연결 24.3% 중 67.5%는 급여 대상 아님
- **실제 매칭 가능한데 못한 것: ~8% 미만**
- 무리한 정규화는 오매칭 위험 → 현 상태 유지 권장

---

## 9. 파일 목록

| 파일 | 설명 |
|------|------|
| `data/bridge/yakga_ingredient_master.csv` | 의약품주성분 마스터 (59,631건) |
| `data/bridge/yakga_master_latest.csv` | 의약품표준코드 (305,522건, 참고용) |
| `data/hira/drug_prices_20260204.json` | HIRA 적용약가 (59,004건) |
| `data/mfds/permits_full_20260203.json` | MFDS 허가정보 (44,035건) |
| `scripts/experiment_matching_v6.py` | 최종 매칭 스크립트 |
| `data/matching_results_v6_20260204.json` | 최종 매칭 결과 |
| `regscan/map/ingredient_bridge.py` | **프로덕션 코드** |
| `scripts/test_ingredient_bridge.py` | 프로덕션 테스트 |

---

## 10. 참고

### 9.1 데이터 출처
- 의약품주성분: https://www.data.go.kr/data/15067461/fileData.do
- 의약품표준코드: https://www.data.go.kr/data/15067462/fileData.do
- ATC 매핑: https://www.data.go.kr/data/15118958/fileData.do
- HIRA 적용약가: https://biz.hira.or.kr

### 9.2 관련 문서
- `docs/data/DATA_SOURCES_INVENTORY.md` - 데이터 소스 인벤토리
- `docs/design/mfds_hira_matching_plan.md` - 초기 매칭 계획
- `docs/research/2026-02-04_inn_matching_research.md` - INN 매칭 조사

---

**문서 버전**: 2.0 (프로덕션 코드 결과 반영)
**최종 수정**: 2026-02-04
