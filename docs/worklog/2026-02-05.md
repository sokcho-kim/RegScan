# 작업일지 - 2026-02-05

## 작업 내역

### 1. LLM 브리핑 테스트 및 문서 생성

| 항목 | 설명 |
|------|------|
| 테스트 스크립트 | `scripts/test_briefing.py` 실행 |
| 결과 | PEMBROLIZUMAB 브리핑 정상 생성 |

**브리핑 출력 예시:**
- Headline: "FDA·EMA 동시 승인 pembrolizumab, 국내 급여 적용 중"
- Key Points: FDA 승인일, MFDS 허가, 급여 상태, 본인부담금

---

### 2. Seladelpar 기사 스크래핑

Playwright를 이용하여 3개 한글 뉴스 기사 스크래핑 완료.

| 출처 | URL | 문자수 |
|------|-----|--------|
| 헬스코리아뉴스 | healthkorea.net | 8,641자 |
| CKN뉴스 | cknnews.co.kr | 7,286자 |
| 데일리팜 | dailypharm.com | 20,644자 |

**결과물:** `data/articles/seladelpar_*.txt`

---

### 3. 일간 모니터링 파이프라인 구현 (신규)

FDA/EMA/MFDS 신규 승인을 매일 수집하고 핫이슈를 자동 감지하는 파이프라인 구현.

**새 모듈:**

| 파일 | 설명 |
|------|------|
| `regscan/monitor/__init__.py` | 모듈 초기화 |
| `regscan/monitor/daily_scanner.py` | 일간 스캐너 핵심 클래스 |
| `scripts/run_daily_scan.py` | CLI 실행 스크립트 |

**핫이슈 스코링 기준:**

| 조건 | 점수 |
|------|------|
| FDA+EMA 동시 승인 | +30 |
| Breakthrough Therapy | +25 |
| Orphan Drug | +20 |
| MFDS 미허가 | +20 |
| CRIS 임상 진행 중 | +15 |
| HIRA 급여 | +10 |

**스캔 결과 (2026-02-05):**
```
FDA 신규: 11건
핫이슈 감지: 5건 (score >= 30)
```

| 핫이슈 | 점수 | 이유 |
|--------|------|------|
| ETANERCEPT | 50 | MFDS 허가 + HIRA 급여 |
| LORLATINIB | 40 | EMA+MFDS 승인 |
| SEMAGLUTIDE | 45 | FDA+EMA+MFDS 모두 승인 |
| SELADELPAR LYSINE | 30 | Orphan + MFDS 미허가 |
| OLANZAPINE AND SAMIDORPHAN | 30 | FDA+MFDS 매칭 |

---

### 4. 핫이슈 브리핑 자동 생성

`--generate-briefing` 옵션으로 핫이슈 약물의 브리핑 자동 생성.

**생성된 브리핑 (Markdown):**

| 파일 | 약물 |
|------|------|
| `briefings/seladelpar_lysine_2026-02-05.md` | SELADELPAR |
| `briefings/semaglutide_2026-02-05.md` | SEMAGLUTIDE |
| `briefings/lorlatinib_2026-02-05.md` | LORLATINIB |
| `briefings/etanercept_2026-02-05.md` | ETANERCEPT |

**저장 위치:** `output/daily_scan/briefings/`

---

### 5. 일간 브리핑 HTML 페이지 (신규)

| 파일 | 설명 |
|------|------|
| `scripts/generate_daily_html.py` | HTML 생성 스크립트 |
| `output/daily_scan/daily_briefing_2026-02-05.html` | 생성된 HTML |

**디자인:**
- 뉴스레터/신문 스타일 (기존 gradient 카드 디자인에서 변경)
- Noto Serif KR + Noto Sans KR 폰트
- summary-bar: FDA/EMA/MFDS/HOT 건수 요약
- 메인 기사 + Other Approvals 테이블
- 메드클레임 박스: 급여 정보, 상한가 표시

**구성 요소:**
1. 헤더: RegScan 로고 + 날짜
2. 요약 바: FDA 11 / EMA 0 / MFDS 0 / HOT 5
3. 메인 기사: 핫이슈 상위 4건 (LLM 브리핑 포함)
4. Other Approvals: 일반 승인 테이블
5. 푸터: 생성 시간

---

## 이슈 해결

### 1. FDA 데이터 형식 이슈
- **문제:** `'list' object has no attribute 'get'`
- **원인:** FDA API 응답이 dict가 아닌 list로 반환
- **해결:** `isinstance(fda_data, list)` 체크 추가

### 2. EMA 필드명 이슈
- **문제:** SELADELPAR가 FDA-EMA 간 매칭 안됨
- **원인:** EMA에서 `international_non_proprietary_name_common_name` 필드 사용
- **해결:** 해당 필드도 파싱하도록 수정

### 3. 약물명 정규화 이슈
- **문제:** `seladelparlysine` ≠ `seladelparlysinedihydrate`
- **원인:** 수화물(hydrate) 접미사 차이
- **해결:** `_normalize_name()`에 hydrate 접미사 제거 로직 추가

---

## 결과물 정리

### 새 파일
```
regscan/monitor/
├── __init__.py
└── daily_scanner.py

scripts/
├── run_daily_scan.py
├── generate_daily_html.py
└── scrape_seladelpar_articles.py

output/daily_scan/
├── daily_briefing_2026-02-05.html
├── scan_result_2026-02-05.json
└── briefings/
    ├── seladelpar_lysine_2026-02-05.md
    ├── semaglutide_2026-02-05.md
    ├── lorlatinib_2026-02-05.md
    └── etanercept_2026-02-05.md

data/articles/
├── seladelpar_healthkorea.txt
├── seladelpar_cknnews.txt
└── seladelpar_dailypharm.txt
```

---

## 다음 할 일

- [ ] EMA/MFDS API 안정화 (현재 0건 수집 이슈)
- [ ] 스케줄러 설정 (cron 또는 APScheduler)
- [ ] Phase 2: 심층 리포트 기능 (기전, 임상시험 결과, 경쟁약 분석)
- [ ] Docker 이미지 빌드 및 Cloud Run 배포

---

## 메모

- 일간 HTML 디자인은 "인공지능 티 나지 않게" 신문/뉴스레터 스타일로 변경
- 핫이슈 기준: score >= 30 (FDA+EMA 동시 또는 Breakthrough+Orphan 등)
- 브리핑 생성 시 API 호출이 필요하므로 핫이슈만 선별하여 생성
