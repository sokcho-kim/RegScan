# 작업일지 - 2026-02-04

## 오늘의 목표

### 1. MFDS 허가 현황 연동
- [x] 공공데이터포털 API 조사
- [x] nedrug.mfds.go.kr 구조 분석
- [x] `regscan/ingest/mfds.py` 수집기 구현
- [x] `regscan/parse/mfds_parser.py` 파서 구현
- [x] GlobalRegulatoryStatus에 MFDS 통합
- [x] EMA ↔ MFDS 성분 매칭 테스트 (79건 매칭 성공)

### 2. CRIS 임상시험 연동
- [x] cris.nih.go.kr 구조 분석
- [x] 공공데이터포털 API 확인
- [x] `regscan/ingest/cris.py` 수집기 구현
- [x] `regscan/parse/cris_parser.py` 파서 구현
- [x] **CRIS API 연동 완료** (11,547건)

### 3. 전체 통합 테스트
- [x] FDA + EMA + MFDS + CRIS 통합
- [x] 국내 영향 분석 로직 구현
- [x] 통합 테스트 성공

---

## 작업 내역

### 1. MFDS API 연동 (완료)

| 항목 | 내용 |
|------|------|
| API | 식품의약품안전처_의약품 제품 허가정보 |
| 엔드포인트 | `apis.data.go.kr/1471000/DrugPrdtPrmsnInfoService07` |
| 데이터 | 44,035건 |
| 수집 | 5,000건 샘플 |

### 2. CRIS API 연동 (완료)

| 항목 | 내용 |
|------|------|
| API | 질병관리청_임상연구 DB |
| 엔드포인트 | `apis.data.go.kr/1352159/crisinfodataview` |
| 데이터 | 11,547건 |
| 수집 | 500건 샘플 |
| 라이선스 | 공공누리 제2유형 (상업적 이용 금지) |

### 3. 전체 통합 테스트 결과 (완료)

**GlobalRegulatoryStatus 생성**
```
입력: FDA 1,462건 + EMA 2,655건 + MFDS 5,000건
출력: 3,395건 GlobalRegulatoryStatus

├── FDA + EMA: 347건
├── EMA + MFDS: 79건
├── FDA + EMA + MFDS: 1건 (BUDESONIDE)
└── 단일 기관: 나머지
```

**핫이슈 스코어 분포**
| 등급 | 건수 | 예시 |
|------|------|------|
| HIGH | 4건 | Seladelpar(65), Polatuzumab(60), Zanidatamab(60), Budesonide(60) |
| MID | 63건 | |
| LOW | 3,328건 | |

**국내 영향 분석**
| 분류 | 건수 | 설명 |
|------|------|------|
| **국내 도입 임박** | **3건** | FDA/EMA 승인 + MFDS 미허가 + CRIS 임상 진행 |
| 국내 도입 불투명 | 1,846건 | FDA/EMA 승인 + MFDS 미허가 + CRIS 없음 |
| 국내 가용 | 1,546건 | MFDS 허가됨 |

**국내 도입 임박 약물**
| 약물 | 글로벌 승인 | CRIS 임상 |
|------|------------|----------|
| USTEKINUMAB | FDA 2025-11-03 | 크론병 임상 |
| SEMAGLUTIDE | FDA+EMA | 당뇨/비만 임상 |
| osimertinib | EMA 2016-02-01 | 폐암 임상 |

### 4. 구현 파일

| 파일 | 설명 |
|------|------|
| `regscan/ingest/mfds.py` | MFDS 수집기 |
| `regscan/ingest/cris.py` | CRIS 수집기 |
| `regscan/parse/mfds_parser.py` | MFDS 파서 |
| `regscan/parse/cris_parser.py` | CRIS 파서 |
| `regscan/map/global_status.py` | MFDS 통합, merge_global_status() |
| `scripts/test_full_integration.py` | 전체 통합 테스트 |

### 5. 수집 데이터

```
data/
├── fda/approvals_20260203.json      # 1,462건
├── ema/medicines_20260203.json      # 2,655건
├── mfds/permits_20260203.json       # 5,000건
└── cris/trials_20260203.json        # 500건
```

---

### 6. 서버 구축 제안서 작성 (완료)

| 파일 | 설명 |
|------|------|
| `docs/proposal/regscan_server_proposal.qmd` | Quarto PPT (6장) |
| `docs/proposal/regscan_server_proposal.html` | 렌더링 결과 |
| `docs/proposal/dashboard_mockup.html` | 목록 화면 시안 |
| `docs/proposal/report_mockup.html` | 브리핑 리포트 시안 |
| `docs/proposal/gcp_cloud_run_spec.md` | GCP 리소스 요청서 |
| `docs/design/llm_report_generation.md` | LLM 리포트 생성 설계 문서 |

**PPT 구성**
1. 프로젝트 개요
2. 작업 계획
3. 필요 자원 (Cloud Run $10/월)
4. 시안: 목록 화면
5. 시안: 브리핑 리포트
6. 데이터 수집 상세

---

## 다음 할 일

### 내일 (02-05)
- [ ] MFDS 전체 수집 (44,035건)
- [ ] CRIS 전체 수집 (11,547건)
- [ ] DomesticImpactAnalyzer 클래스 정식 구현
- [ ] Dockerfile 작성
- [ ] Cloud Run 배포

### 이번 주
- [ ] HIRA 급여목록 수집
- [ ] 스케줄러 설정
- [ ] FastAPI 엔드포인트

### 추후 진행
- [ ] LLM 브리핑 리포트 자동 생성 (`docs/design/llm_report_generation.md` 참고)
- [ ] 메드클레임 시사점 자동 분석 (HIRA 데이터 연동 필요)

---

## 메모

- MFDS 성분명(ITEM_INGR_NAME)은 영문으로 저장됨 → INN 매칭 가능
- CRIS API 응답은 `body` 없이 바로 `items` 반환 (파서 수정함)
- 공공누리 제2유형 = 상업적 이용 금지 (CRIS)
- 공공누리 제1유형/제한없음 = 상업적 이용 가능 (MFDS, FDA, EMA)
